@model IEnumerable<DoAn3Tuan_WebPhone.Models.BinhLuan>
@{
    ViewData["Title"] = "Quản lý bình luận";
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/Css/style.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-2 sidebar bg-dark text-white p-3" style="min-height: 100vh;">
                <h4 class="text-center mb-4">ADMIN</h4>
                <a href="#" class="d-block text-white text-decoration-none p-2">🏠 Dashboard</a>
                <a asp-controller="AdminProduct" asp-action="Index" class="d-block text-white text-decoration-none p-2">📱 Điện thoại</a>
                <a asp-controller="AdminHang" asp-action="Index" class="d-block text-white text-decoration-none p-2">🏷️ Hãng điện thoại</a>
                <a asp-controller="AdminKhachHang" asp-action="Index" class="d-block text-white text-decoration-none p-2">👥 Khách hàng</a>
                <a asp-controller="AdminNhaCungCap" asp-action="Index" class="d-block text-white text-decoration-none p-2">🏭 Nhà cung cấp</a>
                <a asp-controller="AdminKhuyenMai" asp-action="Index" class="d-block text-white text-decoration-none p-2">🎁 Khuyến mãi</a>
                <a asp-controller="AdminDonHang" asp-action="Index" class="d-block text-white text-decoration-none p-2">🛒 Đơn hàng</a>
                <a asp-controller="AdminHoaDon" asp-action="Index" class="d-block text-white text-decoration-none p-2">🧾 Hóa đơn</a>
                <a asp-controller="AdminThongKe" asp-action="Index" class="d-block text-white text-decoration-none p-2">📈 Thống kê</a>
                <a asp-controller="AdminComment" asp-action="Index" class="d-block text-white text-decoration-none p-2 active bg-primary rounded">💬 Bình luận</a>
                <a asp-controller="AdminLienHe" asp-action="Index" class="d-block text-white text-decoration-none p-2">📞 Liên hệ</a>
                <a asp-controller="AdminChat" asp-action="Index" class="d-block text-white text-decoration-none p-2">💬 Tin nhắn khách hàng</a>
                <a asp-controller="AdminLogin" asp-action="Index" class="d-block text-white text-decoration-none p-2">🚪 Đăng xuất</a>
            </div>

            <div class="col-10 p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>💬 Quản lý bình luận</h3>
                    <div class="d-flex gap-2">
                        <form class="d-flex gap-2" method="get" asp-action="Index">
                            <input type="text" name="searchString" value="@ViewBag.Search" class="form-control" placeholder="🔍 Tìm nội dung..." style="width: 300px;">
                            <button type="submit" class="btn btn-success">Tìm</button>
                        </form>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-bordered table-hover text-center align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>Mã BL</th>
                                <th>Mã máy</th>
                                <th>Mã khách</th>
                                <th>Đánh giá</th>
                                <th style="width: 35%;">Nội dung</th>
                                <th>Ngày gửi</th>
                                <th>Trạng thái</th>
                                <th style="width: 150px;">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null)
                            {
                                foreach (var item in Model)
                                {
                                    <tr id="row-@item.MaBinhLuan.Trim()">
                                        <td class="fw-bold">@item.MaBinhLuan</td>
                                        <td>@item.MaDienThoai</td>
                                        <td>@item.MaKhachHang</td>
                                        <td class="text-warning">@item.SoSao ⭐</td>
                                        <td class="text-start small">@item.NoiDung</td>
                                        <td>@item.NgayBinhLuan?.ToString("dd/MM/yyyy")</td>
                                        <td>
                                            @if (item.TrangThai == 1)
                                            {
                                                <span class="badge bg-success">Hiển thị</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">Tạm ẩn</span>
                                            }
                                        </td>
                                        <td>
                                            <div class="d-flex gap-1 justify-content-center">
                                                @if (item.TrangThai == 1)
                                                {
                                                    <button class="btn btn-sm btn-secondary" onclick="doiTrangThai('@item.MaBinhLuan.Trim()', 0)">👁️ Ẩn</button>
                                                }
                                                else
                                                {
                                                    <button class="btn btn-sm btn-primary" onclick="doiTrangThai('@item.MaBinhLuan.Trim()', 1)">✅ Duyệt</button>
                                                }
                                                <button class="btn btn-sm btn-danger" onclick="deleteComment('@item.MaBinhLuan.Trim()')">🗑️ Xóa</button>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>

                @if (ViewBag.TotalPages > 1)
                {
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mt-3">
                            @for (int i = 1; i <= (int)ViewBag.TotalPages; i++)
                            {
                                <li class="page-item @(i == (int)ViewBag.CurrentPage ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { page = i, searchString = ViewBag.Search })">@i</a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
            // Hàm xử lý Duyệt/Ẩn
        function doiTrangThai(id, trangThaiMoi) {
            $.post('/AdminComment/CapNhatTrangThai', { id: id, trangThaiMoi: trangThaiMoi }, function (res) {
                if (res.success) {
                    location.reload();
                } else {
                    alert(res.message);
                }
            });
        }
        function deleteComment(id) {
            if (confirm('Bạn có chắc chắn muốn xóa bình luận này?')) {
                $.ajax({
                    url: '@Url.Action("Delete", "AdminComment")',
                    type: 'POST',
                    data: { id: id },
                    success: function (res) {
                        if (res.success) {
                            alert(res.message);
                            $('#row-' + id).fadeOut(500); // Hiệu ứng xóa mượt
                        } else {
                            alert(res.message);
                        }
                    },
                    error: function () {
                        alert("Lỗi kết nối máy chủ");
                    }
                });
            }
        }
    </script>
</body>
</html>